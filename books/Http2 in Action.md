# HTTP/2 in Action 读书笔记

## 第1章 万维网与 HTTP

### 1.1.2 打开网页时会发生什么

当在浏览器地址栏输入 www.google.com 时，会发生下面的事情：

1. 查询 DNS 服务器获取域名对应的 IP 地址
2. 建立与这个 IP 地址的标准 Web 端口(80或443)的 TCP 连接
3. 请求网页(采用 HTTP 协议，如果使用的 HTTPS，则会有额外的步骤进行安全验证)
4. Google 服务器根据请求的 URL 响应相关内容 (通常是 html 文本)
5. 浏览器处理返回的响应 (解析 html 并在内存中构建 DOM，解析过程中可能会需要额外的资源，比如 css 和图片)
6. 浏览器继续请求构建 DOM 过程中需要的额外资源(普通网页通常需要75个资源，每个资源都需要重复1~6步骤，HTTP/2可以解决这个问题)
7. 浏览器开始在屏幕上渲染页面
8. 当页面完全加载后，浏览器会停止加载图标，然后触发 `load` DOM 事件 (js 可以利用该事件执行某些操作)
9. 此时，页面已经完全加载了，后续会根据 js 逻辑发送请求

### 1.3 HTTP 的语法和历史

HTTP/0.9 仅支持下面的语法：

```http request
GET /page.html
```

也就是说，只支持`GET`方法，并且没有版本号，也没有`header`。响应中也没有状态码，无法判断请求是成功还是失败。

---

HTTP/1.0 新增了下面这些关键特性：
- 更多的请求方法，新增`HEAD`和`POST`方法
- 为消息添加 HTTP 版本号字段
- HTTP头部
- 一个三位整数的响应状态码

HTTP/1.0 中的`GET`方法与 HTTP/0.9 基本相同，只不过有了 header 的加持，可以实现条件 GET 请求。另外，通过 header 也支持获取更多类型的资源，而不仅仅是超文本文档。

`HEAD`方法允许客户端获取资源的元信息而无需下载资源本身。

`POST`方法允许客户端发送数据给服务器，相比通过`GET`的 query 参数发生数据有如下优点：
- URL会受到长度和内容方面的限制(比如无法发送二进制数据，需要进行URL编码)
- 某些机密数据不应该出现在 URL 中，因为可以通过浏览器的历史记录查看这些数据

---

HTTP/1.1

强制添加`Host`头部，以支持 Web 服务器通过虚拟主机的方式托管多网站
```http request
GET / HTTP/1.1
Host: www.google.com
```

持久连接(keep-alive)
```http request
GET /page.html HTTP/1.0
Connection: Keep-Alive
```
这个特性在 HTTP/1.0 中就可以使用了，HTTP/1.1 只是将它添加到标准中，并设置为默认行为。

支持管道(未被很好的实现)
在同一个持久连接上支持发送多个请求并按顺序获取响应。

新方法：`PUT/OPTIONS/CONNECT/TRACE/DELETE`

更好的缓存方法，引入`Cache-Control`头部，比 HTTP/1.0 中的`Expires`头部的选项更多。

其他更多特性：
- HTTP Cookies，允许 HTTP 维护状态
- 引入字符集，在 HTTP 响应中新增语言选项
- 支持代理
- 支持权限验证
- 新的状态码
- 尾随头部(trail header)

### 1.4 HTTPS 简介

HTTPS 对 HTTP 消息添加了3个重要概念：
- 加密
- 完整性校验
- 身份验证：服务器不是伪装的

证书分为 DV(Domain Validated域验证)、OV(Organizational Validated组织验证)、EV
EV证书会在浏览器地址栏处显示公司名称。

当客户端连接到 HTTPS 服务器时，将经历协商阶段(或者叫 TLS 握手)。在此过程中，服务器通过数字证书提供公钥，客户端和服务器协商所使用的加密方法，然后协商接下来要使用的共享密钥。
公钥加密很慢，因此公钥仅用于协商出共享密钥，HTTP 消息采用共享密钥进行加密。
